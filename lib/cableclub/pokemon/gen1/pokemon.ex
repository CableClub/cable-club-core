defmodule CableClub.Pokemon.Gen1.Pokemon do
  use Ecto.Schema
  import Ecto.Changeset
  alias CableClub.Pokemon.Gen1.Pokemon

  @species_index [
    Rhydon: 001,
    Kangaskhan: 002,
    "Nidoran♂": 003,
    Clefairy: 004,
    Spearow: 005,
    Voltorb: 006,
    Nidoking: 007,
    Slowbro: 008,
    Ivysaur: 009,
    Exeggutor: 010,
    Lickitung: 011,
    Exeggcute: 012,
    Grimer: 013,
    Gengar: 014,
    "Nidoran♀": 015,
    Nidoqueen: 016,
    Cubone: 017,
    Rhyhorn: 018,
    Lapras: 019,
    Arcanine: 020,
    Mew: 021,
    Gyarados: 022,
    Shellder: 023,
    Tentacool: 024,
    Gastly: 025,
    Scyther: 026,
    Staryu: 027,
    Blastoise: 028,
    Pinsir: 029,
    Tangela: 030,
    MissingNo: 031,
    MissingNo: 032,
    Growlithe: 033,
    Onix: 034,
    Fearow: 035,
    Pidgey: 036,
    Slowpoke: 037,
    Kadabra: 038,
    Graveler: 039,
    Chansey: 040,
    Machoke: 041,
    "Mr Mime": 042,
    Hitmonlee: 043,
    Hitmonchan: 044,
    Arbok: 045,
    Parasect: 046,
    Psyduck: 047,
    Drowzee: 048,
    Golem: 049,
    MissingNo: 050,
    Magmar: 051,
    MissingNo: 052,
    Electabuzz: 053,
    Magneton: 054,
    Koffing: 055,
    MissingNo: 056,
    Mankey: 057,
    Seel: 058,
    Diglett: 059,
    Tauros: 060,
    MissingNo: 061,
    MissingNo: 062,
    MissingNo: 063,
    Farfetch: 064,
    Venonat: 065,
    Dragonite: 066,
    MissingNo: 067,
    MissingNo: 068,
    MissingNo: 069,
    Doduo: 070,
    Poliwag: 071,
    Jynx: 072,
    Moltres: 073,
    Articuno: 074,
    Zapdos: 075,
    Ditto: 076,
    Meowth: 077,
    Krabby: 078,
    MissingNo: 079,
    MissingNo: 080,
    MissingNo: 081,
    Vulpix: 082,
    Ninetales: 083,
    Pikachu: 084,
    Raichu: 085,
    MissingNo: 086,
    MissingNo: 087,
    Dratini: 088,
    Dragonair: 089,
    Kabuto: 090,
    Kabutops: 091,
    Horsea: 092,
    Seadra: 093,
    MissingNo: 094,
    MissingNo: 095,
    Sandshrew: 096,
    Sandslash: 097,
    Omanyte: 098,
    Omastar: 099,
    Jigglypuff: 100,
    Wigglytuff: 101,
    Eevee: 102,
    Flareon: 103,
    Jolteon: 104,
    Vaporeon: 105,
    Machop: 106,
    Zubat: 107,
    Ekans: 108,
    Paras: 109,
    Poliwhirl: 110,
    Poliwrath: 111,
    Weedle: 112,
    Kakuna: 113,
    Beedrill: 114,
    MissingNo: 115,
    Dodrio: 116,
    Primeape: 117,
    Dugtrio: 118,
    Venomoth: 119,
    Dewgong: 120,
    MissingNo: 121,
    MissingNo: 122,
    Caterpie: 123,
    Metapod: 124,
    Butterfree: 125,
    Machamp: 126,
    MissingNo: 127,
    Golduck: 128,
    Hypno: 129,
    Golbat: 130,
    Mewtwo: 131,
    Snorlax: 132,
    Magikarp: 133,
    MissingNo: 134,
    MissingNo: 135,
    Muk: 136,
    MissingNo: 137,
    Kingler: 138,
    Cloyster: 139,
    MissingNo: 140,
    Electrode: 141,
    Clefable: 142,
    Weezing: 143,
    Persian: 144,
    Marowak: 145,
    MissingNo: 146,
    Haunter: 147,
    Abra: 148,
    Alakazam: 149,
    Pidgeotto: 150,
    Pidgeot: 151,
    Starmie: 152,
    Bulbasaur: 153,
    Venusaur: 154,
    Tentacruel: 155,
    MissingNo: 156,
    Goldeen: 157,
    Seaking: 158,
    MissingNo: 159,
    MissingNo: 160,
    MissingNo: 161,
    MissingNo: 162,
    Ponyta: 163,
    Rapidash: 164,
    Rattata: 165,
    Raticate: 166,
    Nidorino: 167,
    Nidorina: 168,
    Geodude: 169,
    Porygon: 170,
    Aerodactyl: 171,
    MissingNo: 172,
    Magnemite: 173,
    MissingNo: 174,
    MissingNo: 175,
    Charmander: 176,
    Squirtle: 177,
    Charmeleon: 178,
    Wartortle: 179,
    Charizard: 180,
    MissingNo: 181,
    MissingNo: 182,
    MissingNo: 183,
    MissingNo: 184,
    Oddish: 185,
    Gloom: 186,
    Vileplume: 187,
    Bellsprout: 188,
    Weepinbell: 189,
    Victreebel: 190
  ]

  @status_index [
    "No Effect": 0,
    Asleep: 0x4,
    Poisoned: 0x8,
    Burned: 0x10,
    Frozen: 0x20,
    Paralyzed: 0x40
  ]

  @type_index [
    Normal: 0x00,
    Fighting: 0x01,
    Flying: 0x02,
    Poison: 0x03,
    Ground: 0x04,
    Rock: 0x05,
    Bug: 0x07,
    Ghost: 0x08,
    Fire: 0x14,
    Water: 0x15,
    Grass: 0x16,
    Electric: 0x17,
    Psychic: 0x18,
    Ice: 0x19,
    Dragon: 0x1A
  ]

  @move_index [
    Pound: 1,
    "Karate Chop": 2,
    "Double Slap": 3,
    "Comet Punch": 4,
    "Mega Punch": 5,
    "Pay Day": 6,
    "Fire Punch": 7,
    "Ice Punch": 8,
    "Thunder Punch": 9,
    Scratch: 10,
    "Vise Grip": 11,
    Guillotine: 12,
    "Razor Wind": 13,
    "Swords Dance": 14,
    Cut: 15,
    Gust: 16,
    "Wing Attack": 17,
    Whirlwind: 18,
    Fly: 19,
    Bind: 20,
    Slam: 21,
    "Vine Whip": 22,
    Stomp: 23,
    "Double Kick": 24,
    "Mega Kick": 25,
    "Jump Kick": 26,
    "Rolling Kick": 27,
    "Sand Attack": 28,
    Headbutt: 29,
    "Horn Attack": 30,
    "Fury Attack": 31,
    "Horn Drill": 32,
    Tackle: 33,
    "Body Slam": 34,
    Wrap: 35,
    "Take Down": 36,
    Thrash: 37,
    "Double-Edge": 38,
    "Tail Whip": 39,
    "Poison Sting": 40,
    Twineedle: 41,
    "Pin Missile": 42,
    Leer: 43,
    Bite: 44,
    Growl: 45,
    Roar: 46,
    Sing: 47,
    Supersonic: 48,
    "Sonic Boom": 49,
    Disable: 50,
    Acid: 51,
    Ember: 52,
    Flamethrower: 53,
    Mist: 54,
    "Water Gun": 55,
    "Hydro Pump": 56,
    Surf: 57,
    "Ice Beam": 58,
    Blizzard: 59,
    Psybeam: 60,
    "Bubble Beam": 61,
    "Aurora Beam": 62,
    "Hyper Beam": 63,
    Peck: 64,
    "Drill Peck": 65,
    Submission: 66,
    "Low Kick": 67,
    Counter: 68,
    "Seismic Toss": 69,
    Strength: 70,
    Absorb: 71,
    "Mega Drain": 72,
    "Leech Seed": 73,
    Growth: 74,
    "Razor Leaf": 75,
    "Solar Beam": 76,
    "Poison Powder": 77,
    "Stun Spore": 78,
    "Sleep Powder": 79,
    "Petal Dance": 80,
    "String Shot": 81,
    "Dragon Rage": 82,
    "Fire Spin": 83,
    "Thunder Shock": 84,
    Thunderbolt: 85,
    "Thunder Wave": 86,
    Thunder: 87,
    "Rock Throw": 88,
    Earthquake: 89,
    Fissure: 90,
    Dig: 91,
    Toxic: 92,
    Confusion: 93,
    Psychic: 94,
    Hypnosis: 95,
    Meditate: 96,
    Agility: 97,
    "Quick Attack": 98,
    Rage: 99,
    Teleport: 100,
    "Night Shade": 101,
    Mimic: 102,
    Screech: 103,
    "Double Team": 104,
    Recover: 105,
    Harden: 106,
    Minimize: 107,
    Smokescreen: 108,
    "Confuse Ray": 109,
    Withdraw: 110,
    "Defense Curl": 111,
    Barrier: 112,
    "Light Screen": 113,
    Haze: 114,
    Reflect: 115,
    "Focus Energy": 116,
    Bide: 117,
    Metronome: 118,
    "Mirror Move": 119,
    "Self-Destruct": 120,
    "Egg Bomb": 121,
    Lick: 122,
    Smog: 123,
    Sludge: 124,
    "Bone Club": 125,
    "Fire Blast": 126,
    Waterfall: 127,
    Clamp: 128,
    Swift: 129,
    "Skull Bash": 130,
    "Spike Cannon": 131,
    Constrict: 132,
    Amnesia: 133,
    Kinesis: 134,
    "Soft-Boiled": 135,
    "High Jump Kick": 136,
    Glare: 137,
    "Dream Eater": 138,
    "Poison Gas": 139,
    Barrage: 140,
    "Leech Life": 141,
    "Lovely Kiss": 142,
    "Sky Attack": 143,
    Transform: 144,
    "Bubble 	Water": 145,
    "Dizzy Punch": 146,
    Spore: 147,
    Flash: 148,
    Psywave: 149,
    Splash: 150,
    "Acid Armor": 151,
    Crabhammer: 152,
    Explosion: 153,
    "Fury Swipes": 154,
    Bonemerang: 155,
    Rest: 156,
    "Rock Slide": 157,
    "Hyper Fang": 158,
    Sharpen: 159,
    Conversion: 160,
    "Tri Attack": 161,
    "Super Fang": 162,
    Slash: 163,
    Substitute: 164,
    Struggle: 165
  ]

  schema "pokemon_gen1_pokemon" do
    field :nickname, :string

    field :species, Ecto.Enum, values: @species_index
    field :current_hp, :integer
    field :level1, :integer
    field :status, Ecto.Enum, values: @status_index
    field :type1, Ecto.Enum, values: @type_index
    field :type2, Ecto.Enum, values: @type_index
    field :catch_rate, :integer
    field :experience, :integer
    field :move1, Ecto.Enum, values: @move_index
    field :move2, Ecto.Enum, values: @move_index
    field :move3, Ecto.Enum, values: @move_index
    field :move4, Ecto.Enum, values: @move_index
    field :original_trainer_id, :integer
    field :attack_ev, :integer
    field :defense_ev, :integer
    field :speed_ev, :integer
    field :special_ev, :integer
    field :iv, :integer
    field :move1_pp, :integer
    field :move2_pp, :integer
    field :move3_pp, :integer
    field :move4_pp, :integer
    field :level2, :integer
    field :max_hp, :integer
    field :attack, :integer
    field :defense, :integer
    field :speed, :integer
    field :special, :integer

    timestamps()
  end

  def decode(
        <<species::8, current_hp::16, level1::8, status::8, type1::8, type2::8, catch_rate::8,
          move1::8, move2::8, move3::8, move4::8, original_trainer_id::16, experience::24,
          hp_ev::16, attack_ev::16, defense_ev::16, speed_ev::16, special_ev::16, iv::16,
          move1_pp::8, move2_pp::8, move3_pp::8, move4_pp::8, level2::8, max_hp::16, attack::16,
          defense::16, speed::16, special::16>>
      ) do
    %Pokemon{}
    |> cast(
      %{
        species: species,
        current_hp: current_hp,
        level1: level1,
        status: status,
        type1: type1,
        type2: type2,
        catch_rate: catch_rate,
        experience: experience,
        move1: move1,
        move2: move2,
        move3: move3,
        move4: move4,
        original_trainer_id: original_trainer_id,
        hp_ev: hp_ev,
        attack_ev: attack_ev,
        defense_ev: defense_ev,
        speed_ev: speed_ev,
        special_ev: special_ev,
        iv: iv,
        move1_pp: move1_pp,
        move2_pp: move2_pp,
        move3_pp: move3_pp,
        move4_pp: move4_pp,
        level2: level2,
        max_hp: max_hp,
        attack: attack,
        defense: defense,
        speed: speed,
        special: special
      },
      [
        :species,
        :current_hp,
        :level1,
        :status,
        :type1,
        :type2,
        :catch_rate,
        :experience,
        :move1,
        :move2,
        :move3,
        :move4,
        :original_trainer_id,
        :attack_ev,
        :defense_ev,
        :speed_ev,
        :special_ev,
        :iv,
        :move1_pp,
        :move2_pp,
        :move3_pp,
        :move4_pp,
        :level2,
        :max_hp,
        :attack,
        :defense,
        :speed,
        :special
      ]
    )
  end
end
